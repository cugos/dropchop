!function(){var a={version:"0.0.1-dev"};"object"==typeof module&&"object"==typeof module.exports&&(module.exports=a),"undefined"!=typeof window&&window.L&&(window.L.DNC=a)}(),L.DNC=L.DNC||{},L.DNC.AppController=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.mapView=new L.DNC.MapView,this.dropzone=new L.DNC.DropZone(this.mapView._map,{}),this.layerlist=new L.DNC.LayerList({layerContainerId:"dropzone"}).addTo(this.mapView._map),this.menubar=new L.DNC.MenuBar({id:"menu-bar"}).addTo(document.body),this.menus={geo:new L.DNC.Menu("Geoprocessing",{items:["bezier","buffer","center","centroid","envelope","union","tin"]}).addTo(this.menubar)},this.geoOpsConfig={operations:new L.DNC.Geo,executor:new L.DNC.GeoExecute},this.forms=new L.DNC.Forms,this.notification=new L.DNC.Notifications,this._addEventHandlers()},_addEventHandlers:function(){this.dropzone.fileReader.on("fileparsed",this._handleParsedFile.bind(this)),this.menus.geo.on("clickedOperation",this._handleOperationClick.bind(this,this.geoOpsConfig))},_handleOperationClick:function(a,b){var c=a.operations[b.action];try{a.executor.validate(this.getLayerSelection(),c)}catch(d){return this.notification.add({text:d.message,type:"alert",time:2500}),void console.error(d)}var e=this.forms.render(b.action,c);e.on("submit",this._handleFormSubmit.bind(this,a))},_handleFormSubmit:function(a,b){var c=a.operations[b.action],d=a.executor.execute(b.action,b.parameters,c,this.getLayerSelection());c.createsLayer&&this._handleGeoResult(d)},_handleParsedFile:function(a){var b=L.mapbox.featureLayer(a.file);this.layerlist.addLayerToList(b,a.fileInfo.name,!0),this.mapView.numLayers++,this.notification.add({text:"<strong>"+a.fileInfo.name+"</strong> added successfully.",type:"success",time:2500})},_handleGeoResult:function(a){var b=L.mapbox.featureLayer(a.geometry);this.layerlist.addLayerToList(b,a.name,!0),this.notification.add({text:"<strong>"+a.name+"</strong> created successfully.",type:"success",time:2500})},getLayerSelection:function(){return this.layerlist.selection.list||[]}}),L.DNC=L.DNC||{},L.DNC.DropZone=L.Class.extend({statics:{TYPE:"dropzone"},options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this.type=L.DNC.DropZone.TYPE,this.fileReader=new L.DNC.DropZone.FileReader(this._map,b),this.fileReader.enable()}}),L.DNC.DropZone=L.DNC.DropZone||{},L.DNC.DropZone.FileReader=L.Handler.extend({includes:L.Mixin.Events,options:{},initialize:function(a,b){L.setOptions(this,b),this._map=a,this._container=document.body},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{options:this.options}),this._map.fire("dropzone:enabled",{options:this.options}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("dropzone:disabled",{options:this.options}),this.fire("disabled",{options:this.options}))},addHooks:function(){this._map&&(L.DomEvent.on(this._container,"dragover",this._handleDragOver,this),L.DomEvent.on(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.on(this._container,"drop",this._handleDrop,this))},removeHooks:function(){this._map&&(L.DomEvent.off(this._container,"dragover",this._handleDragOver,this),L.DomEvent.off(this._container,"dragleave",this._handleDragLeave,this),L.DomEvent.off(this._container,"drop",this._handleDrop,this))},_handleDragOver:function(a){a=a||event,a.preventDefault(),document.body.className="dragging"},_handleDragLeave:function(a){a=a||event,a.preventDefault(),document.body.className=""},_handleDrop:function(a){a=a||event,a.preventDefault(),document.body.className="";var b=a.dataTransfer.files;this._handleFiles(b)},_handleFiles:function(a){for(var b=0;b<a.length;b++)this._readFile(a[b])},_readFile:function(a){var b=new FileReader;b.readAsText(a,"UTF-8"),b.onload=function(){var c=JSON.parse(b.result);this._map.fire("dropzone:fileparsed",{file:c}),this.fire("fileparsed",{fileInfo:a,file:c})}.bind(this)}}),L.DNC=L.DNC||{},L.DNC.Forms=L.Class.extend({includes:L.Mixin.Events,options:{},render:function(a,b){this.title=a,this.paramArray=[],this.options={},L.setOptions(this,b);var c='<div class="form-inner"><div class="form"><button type="button" class="btn close form-close"><i class="fa fa-times"></i></button><div class="form-information"><h3 class="form-title">'+this.title+'</h3><p class="form-description">'+this.options.description+'</p></div><form class="form-inputs">';if(this.options.parameters)for(var d=0;d<this.options.parameters.length;d++){var e=this.options.parameters[d],f='<div class="parameter"><label class="parameter-name">'+e.name+"</label>";f+="select"==e.type?this._inputTypeSelect(e):this._inputTypeDefault(e),e.description&&(f+='<p class="parameter-description">'+e.description+"</p>"),c+=f+"</div>"}c+='<button type="button" class="btn form-submit" id="operation-submit">Execute<i class="fa fa-thumbs-o-up push-left"></i></button>',c+="</div></div>";var g=document.createElement("div");return g.className="form-outer",g.id="DNC-FORM",g.innerHTML=c,document.body.appendChild(g),this.domElement=g,this._formHandlers(g),this},closeForm:function(){var a=document.getElementById("DNC-FORM");a.parentElement.removeChild(a)},submitForm:function(){this.paramArray=[];for(var a=document.getElementsByClassName("param"),b=0;b<a.length;b++){var c=null;"SELECT"==a[b].nodeName?c=a[b].options[a[b].selectedIndex].value:(c=a[b].value,"number"==a[b].type&&(c=parseInt(c))),this.paramArray.push(c)}this.validateForm()&&(this.fire("submit",{action:this.title,parameters:this.paramArray}),this.closeForm(),this._leaflet_events.submit=[])},validateForm:function(){return!0},_formHandlers:function(){for(var a=document.getElementsByClassName("form-close"),b=0;b<a.length;b++)a[b].addEventListener("click",this.closeForm.bind(this));var c=document.getElementById("operation-submit");c.addEventListener("click",this.submitForm.bind(this))},_inputTypeDefault:function(a){var b='<input class="param" name="'+a.name+'" type="'+a.type+'" value="'+a["default"]+'">';return b},_inputTypeSelect:function(a){for(var b='<select class="param" type="select" name="'+a.name+'">',c=0;c<a.options.length;c++)b+='<option value="'+a.options[c]+'"',a.options[c]==a["default"]&&(b+=" selected"),b+=">"+a.options[c]+"</option>";return b+"</select>"}}),L.DNC=L.DNC||{},L.DNC.LayerList=L.Control.extend({options:{autoZIndex:!0,zoomToExtentOnAdd:!0,layerContainerId:"dropzone"},initialize:function(a){L.setOptions(this,a),this._layers={},this._lastZIndex=0,this._handlingClick=!1,this.layerContainer=L.DomUtil.get(this.options.layerContainerId),this.selection={add:function(a){this.list.push(a)},remove:function(a){for(var b=0;b<this.list.length;b++)a._leaflet_id==this.list[b].layer._leaflet_id&&this.list.splice(b,1)},list:[]}},_initLayout:function(){this._container=L.DomUtil.create("ul","json-layer-list"),this._container.setAttribute("id","layer-list"),this.layerContainer.appendChild(this._container)},onAdd:function(){return this._initLayout(),this._update(),this._container},addTo:function(a){return this.remove(),this._map=a,this._container=this.onAdd(a),this},remove:function(){return this._map?(this._container.parentElement.removeChild(this._container),this._container=null,this.onRemove&&this.onRemove(this._map),this._map=null,this):this},addLayerToList:function(a,b,c){var d=L.stamp(a);if(this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex)),this._update(),this.options.zoomToExtentOnAdd){var e=a.getBounds();for(var f in this._layers)e.extend(this._layers[f].layer.getBounds());this._map.fitBounds(e)}},removeLayerFromList:function(a){var b=L.stamp(a);return delete this._layers[b],this},_update:function(){if(!this._container)return this;for(var a in this._layers)obj=this._layers[a],this._map.hasLayer(obj.layer)||(this._map.addLayer(obj.layer),this._addItem(obj));return this},_addItem:function(a){var b=document.createElement("input");b.setAttribute("type","checkbox"),b.setAttribute("checked","true"),b.className="layer-toggle",b.setAttribute("data-id",L.stamp(a.layer)),b.onchange=this._handleLayerChange.bind(this,a);var c=document.createElement("div");c.className="layer-name",c.innerHTML=a.name,c.setAttribute("data-id",L.stamp(a.layer)),c.onclick=this._handleLayerClick.bind(this,a);var d=document.createElement("li");d.className="layer-element "+a.name,d.appendChild(b),d.appendChild(c),this._container.appendChild(d)},_handleLayerChange:function(a,b){var c=b.target;c.checked?this._map.addLayer(a.layer):this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer)},_handleLayerClick:function(a,b){-1==b.currentTarget.className.indexOf("selected")?(b.currentTarget.className+=" selected",this.selection.add({info:a,layer:a.layer})):(this.selection.remove(a.layer),b.currentTarget.className="layer-name")}}),L.DNC=L.DNC||{},L.DNC.MapView=L.Class.extend({statics:{},options:{},initialize:function(a){L.setOptions(this,a),this.numLayers=0,this._map=null,this._setupMap()},_setupMap:function(){L.mapbox.accessToken="pk.eyJ1Ijoic3ZtYXR0aGV3cyIsImEiOiJVMUlUR0xrIn0.NweS_AttjswtN5wRuWCSNA",this._map=L.mapbox.map("map",null,{zoomControl:!1}).setView([0,0],3);var a={"Mapbox Streets":L.mapbox.tileLayer("mapbox.streets"),"Mapbox Outdoors":L.mapbox.tileLayer("mapbox.outdoors"),"Mapbox Light":L.mapbox.tileLayer("mapbox.light"),"Mapbox Dark":L.mapbox.tileLayer("mapbox.dark"),"Mapbox Satellite":L.mapbox.tileLayer("mapbox.satellite")};a["Mapbox Streets"].addTo(this._map),L.control.layers(a,{},{position:"bottomright",collapsed:!1}).addTo(this._map),L.control.zoom({position:"topright"}).addTo(this._map)}}),L.DNC=L.DNC||{},L.DNC.Menu=L.Class.extend({includes:L.Mixin.Events,initialize:function(a,b){L.setOptions(this,b),this.title=a,this.children=this._buildMenuItems(this.options.items),this.domElement=this._buildDomElement(this.children),this._addEventHandlers()},_addEventHandlers:function(){function a(){var a=this.querySelector(".menu-dropdown");if(-1==a.className.indexOf("expanded")){for(var b=document.getElementsByClassName("expanded"),c=0;c<b.length;c++)b[c].className=b[c].className.replace(/\b expanded\b/,"");a.className+=" expanded"}else a.className=a.className.replace(/\b expanded\b/,"")}function b(){c.fire("clickedOperation",{action:this.id})}var c=this;if(this.domElement&&this.domElement.addEventListener("click",a,!1),this.children)for(var d=0;d<this.children.length;d++)this.children[d].addEventListener("click",b,!1)},addTo:function(a){var b=a.domElement||a;return b.appendChild(this.domElement),this.parent=a,this},_buildMenuItems:function(a){for(var b=[],c=0;c<a.length;c++){var d=document.createElement("button");d.className="menu-button menu-button-action",d.id=a[c],d.innerHTML=a[c],b.push(d)}return b},_buildDomElement:function(a){var b=document.createElement("div");b.className="menu",b.innerHTML='<button class="menu-button">'+this.title+'<i class="fa fa-angle-down"></i></button>';var c=document.createElement("div");c.className="menu-dropdown menu-expand";for(var d=0;d<a.length;d++)c.appendChild(a[d]);return b.appendChild(c),b}}),L.DNC=L.DNC||{},L.DNC.MenuBar=L.Class.extend({includes:L.Mixin.Events,options:{id:"#menu-bar"},initialize:function(a){L.setOptions(this,a),this.children=[],this.domElement=this._buildDomElement(this.options.id)},addTo:function(a){var b=a.domElement||a;return b.appendChild(this.domElement),this.parent=a,this},_buildDomElement:function(a){var b=document.createElement("nav");return b.id=a,b}}),L.DNC=L.DNC||{},L.DNC.Notifications=L.Class.extend({statics:{},options:{},initialize:function(a,b){L.setOptions(this,b),this.domElement=this._buildDomElement(),this.hub=document.getElementById("notifications")},add:function(a){params={},params.text=a.text||"THIS NOTIFICATION REQUIRES TEXT",params.time=a.time||4e3,params.type=a.type||"default";var b=document.createElement("div");b.className="notification "+a.type,b.innerHTML=a.text,this.hub.appendChild(b);var c=this;setTimeout(function(){c.hub.removeChild(c.hub.firstChild)},params.time)},_buildDomElement:function(){var a=document.createElement("div");return a.id="notifications",document.body.appendChild(a),a}}),L.DNC.Geo=L.Class.extend({includes:L.Mixin.Events,options:{},bezier:{minFeatures:1,description:"Takes a line and returns a curved version by applying a Bezier spline algorithm.",parameters:[{name:"resolution",description:"Time in milliseconds between points",type:"number","default":1e4},{name:"sharpness",description:"a measure of how curvy the path should be between splines",type:"number","default":.85}],createsLayer:!0},buffer:{maxFeatures:1,additionalArgs:.1,description:"Calculates a buffer for input features for a given radius. Units supported are miles, kilometers, and degrees.",parameters:[{name:"distance",description:"Distance to draw the buffer.",type:"number","default":10},{name:"unit",type:"select",description:"",options:["miles","feet","kilometers","meters","degrees"],"default":"miles"}],createsLayer:!0},center:{minFeatures:1,maxFeatures:1,description:"Creates a point in the center of the feature.",createsLayer:!0},centroid:{minFeatures:1,maxFeatures:1,description:"Creates a point in the centroid of the features.",createsLayer:!0},envelope:{minFeatures:1,maxFeatures:1,description:"Extent of all the features.",createsLayer:!0},union:{minFeatures:2,maxFeatures:2,description:"Takes two polygons and returns a combined polygon. If the input polygons are not contiguous, this function returns a MultiPolygon feature.",createsLayer:!0},tin:{minFeatures:1,maxFeatures:1,description:"Triangulated irregular network, interpolation method"}}),L.DNC=L.DNC||{},L.DNC.GeoExecute=L.Class.extend({includes:L.Mixin.Events,options:{},execute:function(a,b,c,d){L.setOptions(this,c),this.action=a;var e=this._prepareParameters(d,c,b),f=this._prepareName(d);console.debug(e,f);var g={geometry:turf[this.action].apply(null,e),name:this.action+"_"+f+".geojson"};return"FeatureCollection"==g.geometry.type&&1==g.geometry.features.length&&(g.geometry=this._unCollect(g.geometry)),g},validate:function(a,b){function c(a){this.name="ValidationError",this.message=a||"Validation Error"}var d=a.length;if(c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,!d)throw new c("Can't run "+this.title+" on empty selection.");if(b.maxFeatures&&d>b.maxFeatures)throw new c("Too many layers. Max is set to "+b.maxFeatures+", got "+d+".");if(b.minFeatures&&d<b.minFeatures)throw new c("Too few layers. Min is set to "+b.minFeatures+", got "+d+".")},_prepareParameters:function(a,b,c){b.maxFeatures&&(a=a.slice(0,b.maxFeatures));var d=a.map(function(a){return a.layer._geojson});if(console.debug(d,c),c)for(var e=0;e<c.length;e++)d.push(c[e]);return d},_prepareName:function(a){var b=a.map(function(a){return a.info.name}),c="";return c=1===b.length?b[0].split(".")[0]:b.reduce(function(a,b){return a.split(".")[0]+"_"+b.split(".")[0]})},_unCollect:function(a){return a.features[0]}});
//# sourceMappingURL=L.DNC.min.js.map